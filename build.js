angular.module("jam","jam.services jam.songs jam.profile jam.auth ngRoute ngAnimate".split(" ")).run(function(a){a.user={}}).config(function(a,b){a.when("/login",{templateUrl:"auth/login.html",controller:"AuthController"}).when("/signup",{templateUrl:"auth/signup.html",controller:"AuthController"}).when("/songs",{templateUrl:"songs/songs.html",controller:"SongsController",authenticate:!0}).when("/profile",{templateUrl:"profile/profile.html",controller:"ProfileController",authenticate:!0}).otherwise({redirectTo:"/songs"});
b.interceptors.push("AttachTokens")}).factory("AttachTokens",function(a){return{request:function(b){var c=a.localStorage.getItem("com.jam");c&&(b.headers["x-access-token"]=c);b.headers["Allow-Control-Allow-Origin"]="*";return b}}}).run(function(a,b,c){a.$on("$routeChangeStart",function(a,e,f){e.$$route&&e.$$route.authenticate&&!c.isAuth()&&b.path("/login")})});angular.module("jam.auth",[]).controller("AuthController",["$scope","$window","$location","Auth",function(a,b,c,d){a.user={};a.login=function(){d.login(a.user).then(function(a){b.localStorage.setItem("com.jam",a.token);$rootScope.user=a.user;c.path("/songs")})["catch"](function(a){console.error(a)})};a.signup=function(){a.user.displayName="anonymous";d.signup(a.user).then(function(a){b.localStorage.setItem("com.jam",a.token);$rootScope.user=a.user;c.path("/profile")})["catch"](function(a){console.error(a)})};
a.logout=function(){d.logout()}}]);angular.module("jam.profile",[]).controller("ProfileController",function(a,b,c,d,e){e.user||d.logout();a.profile=e.user;a.updateProfile=function(){c.updateUser(a.profile).then(function(a){console.log("Profile updated",a.data);b.path("/songs")})["catch"](function(a){console.error(a)})}});angular.module("jam.services",[]).factory("Songs",function(a){return{addSong:function(b){return a({method:"POST",url:"/api/songs",data:b}).then(function(a){return a})},getAllSongs:function(){return a({method:"GET",url:"/api/songs"}).then(function(a){return a.data})}}}).factory("Profile",function(a){return{updateUser:function(b){return a({method:"PUT",url:"/api/user",data:b})}}}).factory("Auth",function(a,b,c){return{login:function(b){return a({method:"POST",url:"/api/users/login",data:b}).then(function(a){return a.data})},
signup:function(b){return a({method:"POST",url:"/api/users/signup",data:b}).then(function(a){return a.data})},getUser:function(b){console.log("services headers:",c.localStorage.getItem("com.jam"));return a({method:"GET",url:"/api/users/"+b}).then(function(a){return a.data})},isAuth:function(){return!!c.localStorage.getItem("com.jam")},logout:function(){c.localStorage.removeItem("com.jam");b.path("/login")}}});angular.module("jam.songs",[]).controller("SongsController",function(a,b){a.data={};b.getAllSongs().then(function(b){a.data.songs=b})["catch"](function(a){console.error(a)})});
